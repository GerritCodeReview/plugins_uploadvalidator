{
  "comments": [
    {
      "key": {
        "uuid": "30b44f28_6dae53b8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2020-08-06T09:25:29Z",
      "side": 1,
      "message": "Reintroducing the Tika dependency is causing issues for us as Tika is using ffmpeg. In this state, we can\u0027t use the uploadvalidator plugin.\n\nAs this revert happened three years after the removal, I actually consider this change as new (and introducing a new library) and not a revert. I would revert this change and ask you to find another solution for the binary detection issue you\u0027re describing. Or do you have a different proposal to resolve this, Lucas?",
      "revId": "1588062a59ad421307dba24fb8dde68fcfc1f0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9db1599c_1fadadd2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-08-08T17:34:42Z",
      "side": 1,
      "message": "Where is Apache Tika [1] using ffmpeg ?\n\nAFAICS the dependencies of tika-core 1.12-rc1 (didn\u0027t find a tag for 1.12) which is used here are:\n\ntika-core ((1.12-rc1))]$ mvn dependency:tree\n[INFO] Scanning for projects...\n[INFO]\n[INFO] ---------------------\u003c org.apache.tika:tika-core \u003e----------------------\n[INFO] Building Apache Tika core 1.12\n[INFO] -------------------------------[ bundle ]-------------------------------\n[INFO]\n[INFO] --- maven-dependency-plugin:2.8:tree (default-cli) @ tika-core ---\n[INFO] org.apache.tika:tika-core:bundle:1.12\n[INFO] +- org.osgi:org.osgi.core:jar:4.0.0:provided\n[INFO] +- org.osgi:org.osgi.compendium:jar:4.0.0:provided\n[INFO] +- biz.aQute:bndlib:jar:1.43.0:provided\n[INFO] \\- junit:junit:jar:4.11:test\n[INFO]    \\- org.hamcrest:hamcrest-core:jar:1.3:test\n\nlooking at the latest release 1.24.1 there is still no dependency on ffmpeg:\n\ntika-core ((1.24.1))]$ mvn dependency:tree\n[INFO] Scanning for projects...\n[INFO]\n[INFO] ---------------------\u003c org.apache.tika:tika-core \u003e----------------------\n[INFO] Building Apache Tika core 1.24.1\n[INFO] -------------------------------[ bundle ]-------------------------------\n[INFO]\n[INFO] --- maven-dependency-plugin:2.8:tree (default-cli) @ tika-core ---\n[INFO] org.apache.tika:tika-core:bundle:1.24.1\n[INFO] +- org.osgi:org.osgi.core:jar:6.0.0:provided\n[INFO] +- org.osgi:org.osgi.compendium:jar:4.0.0:provided\n[INFO] +- biz.aQute:bndlib:jar:1.50.0:provided\n[INFO] \\- junit:junit:jar:4.13:test\n[INFO]    \\- org.hamcrest:hamcrest-core:jar:1.3:test\n\nRelease notes of Tika 1.9 [3] state that ffmpeg can be used as an external parser if installed separately (which isn\u0027t done here) and according to [2] the project is following the Apache 3rd party license policy [4].\n\n[1] https://github.com/apache/tika\n[2] https://tika.apache.org/contribute.html#Dependencies\n[3] https://dist.apache.org/repos/dist/release/tika/CHANGES-1.24.1.txt\n\"* If FFMPEG is installed and on the PATH, it is a \n    usable Parser in Tika now (TIKA-1510).\"\n[4] https://www.apache.org/legal/resolved.html",
      "parentUuid": "30b44f28_6dae53b8",
      "revId": "1588062a59ad421307dba24fb8dde68fcfc1f0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dd09b27e_63e11bf7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2020-08-10T10:26:04Z",
      "side": 1,
      "message": "You\u0027re right that there isn\u0027t a direct dependency visible. The issue is that Tika checks whether ffmpeg is installed by executing some commands. That execution is already causing issues for us.\n\nWe only need the mimetype detection of Tika, don\u0027t we? If so, there might be a solution to this. The Tika class [1] instantiates both parsers and detectors. The instantiation of the parsers contains the ffmpeg check. As we only call the detect() method on the Tika class, we could directly instantiate the DefaultDetector [2].\n\n[1] https://github.com/apache/tika/blob/main/tika-core/src/main/java/org/apache/tika/Tika.java\n[2] https://github.com/apache/tika/blob/main/tika-core/src/main/java/org/apache/tika/detect/DefaultDetector.java",
      "parentUuid": "9db1599c_1fadadd2",
      "revId": "1588062a59ad421307dba24fb8dde68fcfc1f0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4e2c6605_84e24077",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1030912
      },
      "writtenOn": "2020-08-20T14:08:37Z",
      "side": 1,
      "message": "Implemented in I76ec0c488. I\u0027d appreciate a timely review.",
      "parentUuid": "dd09b27e_63e11bf7",
      "revId": "1588062a59ad421307dba24fb8dde68fcfc1f0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4fab8953_2224ed0f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1011842
      },
      "writtenOn": "2020-08-20T18:41:35Z",
      "side": 1,
      "message": "One thing I\u0027d add is that Tika creates a huge attack surface for untrusted input. I don\u0027t think we\u0027re comfortable running it on `*.googlesource.com`.",
      "parentUuid": "4e2c6605_84e24077",
      "revId": "1588062a59ad421307dba24fb8dde68fcfc1f0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7d87c647_39a5ead2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1004034
      },
      "writtenOn": "2020-08-21T08:42:50Z",
      "side": 1,
      "message": "maybe the alternative implementation in Iecdae64b2039bd6717926e1b6dcb1f59b04a593e can address your concerns ?",
      "parentUuid": "4fab8953_2224ed0f",
      "revId": "1588062a59ad421307dba24fb8dde68fcfc1f0b0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}